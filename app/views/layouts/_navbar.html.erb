<nav class="navbar navbar-default navbar-fixed-top navbar-wagon" role="navigation">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header padding-top-5 horizontal-spacer">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <table>
        <td>
          <%= link_to offers_path do %>
            <%= image_tag "logo.png", id: "logo" %>
          <% end %>
        </td>
        <td>
          <%= link_to "lovely hood", offers_path, id: "brand" %>
        </td>
      </table>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <% if user_signed_in? %>
        <form class="navbar-form navbar-left margin-top-13" action="">
          <input class="typeahead form-control fa-placeholder search-placeholder" type="text" id="query"
              autocomplete="off" spellcheck="false" autocapitalize="off"
              placeholder="Rechercher un objet, un service..."></input>
        </form>

        <ul class="nav navbar-nav navbar-right">
          <li class="disappear middle-weight">
            <%= link_to offers_path do %>
              <i class="fa fa-home"></i> Annonces
            <% end %>
          </li>
          <li class="disappear middle-weight">
            <% if current_user.conversations.size > 0 %>
              <%= link_to (conversation_path(current_user.conversations.sort_by { |c| c.messages.last.updated_at }.last, anchor: "message-input")) do %>
                <i class="fa fa-envelope"></i> Messages
                <% if current_user.unread_conversations > 0 %>
                  <span class="badge">
                    <%= current_user.unread_conversations %>
                  </span>
                <% end %>
              <% end %>
            <% else %>
            <% end %>
          </li>
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
              <div class="img-navbar col-xs-2 padding-none">
                <% if current_user.picture_file_name %>
                  <%= image_tag(current_user.picture.url(:medium), { class: "img" }) %>
                <% else %>
                  <%= image_tag "user_pic-225x225.png", class: "img-logo-small" %>
                <% end %>
              </div>
              <strong><%= current_user.first_name %><span class="caret"></span></strong></a>
            <ul class="dropdown-menu" role="menu">
              <li>
                <%= link_to user_path(current_user) do %>
                  Voir mon profil
                  <% if current_user.passed_bookings_to_validate[:owner].size >= 1 %>
                    &nbsp;
                    <span class="badge small-badge">
                      <%= current_user.passed_bookings_to_validate[:owner].size %>
                    </span>
                  <% end %>
                <% end %>
              </li>
              <li><%= link_to "Modifier mon profil", edit_user_path(current_user) %></li>
              <li><%= link_to "Toutes les annonces", offers_path %></li>
              <li><%= link_to "Mes annonces", mine_path %></li>
              <li><%= link_to "Ma wish list", wishlist_path %></li>
              <li class="appear">
                <% if current_user.conversations.size > 0 %>
                  <%= link_to (conversation_path(current_user.conversations.sort_by { |c| c.messages.last.updated_at }.last, anchor: "message-input")) do %>
                    Messages
                    <% if current_user.unread_conversations > 0 %>
                      <span class="badge">
                        <%= current_user.unread_conversations %>
                      </span>
                    <% end %>
                  <% end %>
                <% else %>
                <% end %>
              </li>
              <li><%= link_to 'Deconnexion', destroy_user_session_path, method: 'delete' %></li>
            </ul>
          </li>
        <% else %>
          <ul class="nav navbar-nav navbar-right">
            <li><%= link_to 'Inscription', new_user_registration_path %></li>
            <li><%= link_to 'Connexion', new_user_session_path %></li>
        <% end %>
        <li><%= link_to 'Publier une annonce', new_offer_path, class: "btn btn-primary", id: "nav-btn" %></li>
      </ul>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>

<% content_for(:js) do %>
  <!-- Typahead.js is used to display the auto-completion menu -->
  <script src="//cdnjs.cloudflare.com/ajax/libs/typeahead.js/0.10.4/typeahead.bundle.min.js"></script>
  <!-- Algolia -->
  <script src="//cdn.jsdelivr.net/algoliasearch/latest/algoliasearch.min.js"></script>

  <script type="text/javascript">
    $(document).ready(function() {
      // Replace the following values by your ApplicationID and ApiKey.
      var algolia = new AlgoliaSearch(
        '<%= ENV['ALGOLIA_APPLICATION_ID'] %>',
        '<%= ENV['ALGOLIA_SEARCH_ONLY_API_KEY'] %>'
      );
      // replace YourIndexName by the name of the index you want to query.
      var index = algolia.initIndex('Offer<%= ENV['ALGOLIA_SUFFIX'] %>');
      // typeahead.js initialization
      $('#query').typeahead({ hint: false }, {
        source: index.ttAdapter({ hitsPerPage: 5 }),
        displayKey: 'email',
        templates: {
          suggestion: function(hit) {
            // render the hit
            return '<div class="offer-stream-box border-btm side-borders white-bg" id="offer_'+ hit.id + '">' +
              '<div class="row">' +
                '<div class="col-xs-1">' +
                  '<div width="img-nature-box">' +
                    '<a href="/offers/' + hit.id + '">' +
                      hit.icon_img +
                    '</a>' +
                  '</div>' +
                '</div>' +
                '<div class="col-xs-9 padding-left-30">' +
                  '<h5 class="margin-none"><a href="/offers/' + hit.id + '" class="offer-nature-link">' + hit._highlightResult.nature.value + '</a></h5>' +
                  '<p class="small margin-top-10">' +
                    '<a href="/offers/' + hit.id + '" class="link-unstyled">' +
                      hit._highlightResult.description.value +
                    '</a>' +
                  '</p>' +
                '</div>' +
                '<div class="col-xs-2 text-right padding-top-15 padding-left-none padding-right-20">' +
                  '<h5 class="margin-none text-right price">' +
                    hit.one_price_int + 'â‚¬' +
                  '</h5>' +
                '</div>' +
              '</div>' +
            '</div>'
          }
        }
      });
    });
  </script>
<% end %>