<%= content_for(:title) do %>
  <%= t('.title') %>
<% end %>
<%= content_for(:description) do %>
  <%= t('.description') %>
<% end %>
<div class="container">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2">
      <div class="panel panel-default white-bg margin-top-15 padding-none" id="mine">
        <div class="panel-heading border-btm-none">
          <h4><%= t('.my_offers') %></h4>
        </div>
        <div class="panel-body padding-none border-top-221">
          <% if current_user.offers.size > 0 %>
            <% current_user.offers.sort_by(&:updated_at).reverse.each do |offer| %>
              <div class="col-xs-6 col-sm-4" id="popContainer_<%= offer.id %>">
                <%= render "offer", offer: offer %>
              </div>
            <% end %>
          <% else %>
            <div class="offer-stream-box border-top">
              <p><%= t('.no_offer') %></p>
              <p><%= link_to "Publier une annonce", new_offer_path %></p>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
<%= content_for :js do %>
  <% javascript_tag do %>
    $(document).ready(function() {
      var width = $('.card').css('width')
      $('.card').css('height', width)
      $('.card').popover({
        html: true,
        placement: function(context, source) {
          var position = $(source).offset().top;
          if(position < 300) {
            return "bottom"
          } else {
            return "top"
          }
        }
      })
      $(window).on('resize', function() {
        var width = $('.card').css('width')
        $('.card').css('height', width)
      })
      $('.card').on('mouseenter', function(){
        $(this).click()
      })
      $('.card').on('dblclick', function() {
        location.href = $(this).children().last().attr('href')
      })
      var popover
      $('.card').on('click', function(e) {
        e.preventDefault()
        popover = $(this).next()
        setTimeout(function() {
          $.each($('.popover'), function(index, item) {
            if(item == popover[0]) {
            } else {
              item.remove()
            }
          })
        }, 100)
        $('.offer_published').on('change', function() {
          var id = parseInt($(this).first().parent().parent().parent().parent().attr('id').slice($(this).first().parent().parent().parent().parent().attr('id').lastIndexOf("_") + 1))
          var published = $(this).val()
          if(published == "true") {
            $.ajax({
              type: "PUT",
              url: "/offers/" + id + "/publish",
              dataType: "script"
            })
          } else {
            $.ajax({
              type: "PUT",
              url: "/offers/" + id + "/hide",
              dataType: "script"
            })
          }
          notices()
        })
      })
    })
  <% end %>
<% end %>